#config/pipelines.yaml

pipelines:
#-------------------------------------------------------------------
# Extracts oireachtas questions via API
#-------------------------------------------------------------------

#  - name: oireachtas_questions
#    type: pipelines.oireachtas_pipeline.OireachtasDataPipeline
#    params:
#      date_start: "2023-01-01"
#      date_end: "2024-12-31"
#      chunk_size: 1000

#-------------------------------------------------------------------
# Extracts boards.ie discussions via API - for politics forum
#-------------------------------------------------------------------
#  - name: boards_politics
#    type: pipelines.boards_pipeline.BoardsDataPipeline
#    params:
#      category_id: 1728 #politics-politics forum
#      limit: 100
#      date_start: "2025-01-01" #LastCommentDate
#      date_end: "2026-01-30"
#      chunk_size: 500

#-------------------------------------------------------------------
# Extracts boards.ie discussions via API - for current affairs forum
#-------------------------------------------------------------------
#  - name: boards_politics
#    type: pipelines.boards_pipeline.BoardsDataPipeline
#    params:
#      category_id: 1846 #current affairs imho forum
#      limit: 100
#      date_start: "2025-01-01" #LastCommentDate
#      date_end: "2026-01-30"
#      chunk_size: 500

#-------------------------------------------------------------------
# Extracts boards.ie comments via API - using the discussions
# API - note this is untested as yet
#-------------------------------------------------------------------

#  - name: boards_comments
#    type: pipelines.boards_comments_pipeline.BoardsCommentsPipeline
#    params:
#      discussion_source_cfg:
#        type: api
#        category_id: 1728
#      limit: 500
#      date_start: "2025-01-01"
#      date_end: "2025-12-31"
#      chunk_size: 500

#-------------------------------------------------------------------
# Extracts boards.ie comments via API - for previously stored
# discussions (dbo.boards_discussions)
#-------------------------------------------------------------------

#  - name: boards_comments_db
#    type: pipelines.boards_comments_pipeline.BoardsCommentsPipeline
#    params:
#      # Use the DB as the discussion source. The 'where' value is raw SQL applied to the table.
#      discussion_source_cfg:
#        type: db
#        table: dbo.boards_discussions
#        #where: "CategoryId = 1728 AND DateLastComment BETWEEN '2025-01-01' AND '2025-12-31'"
#      limit: 500 # limit controls the per-request page size when fetching comments from the API
#      # date_start/date_end will be passed to the comments API as the dateInserted range
#      date_start: "2025-01-01"
#      date_end: "2025-12-31"
#      chunk_size: 500 # chunk_size controls how many comments are saved to the DB at once

#-------------------------------------------------------------------
# Extracts boards.ie comments directly from the DB table dbo.boards_comments
#-------------------------------------------------------------------
#  - name: boards_comments_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      output_csv: data/boards_comments.csv
#      extractor_params:
#        model: BoardsComment
#        filters:
#          #discussionID: 2058391856
#          dateInserted:
#            from: "2025-01-01"
#            to: "2025-12-31"
#        order_by:
#          column: dateInserted
#          direction: desc



#-------------------------------------------------------------------
# Extracts oireachtas parties via API
#-------------------------------------------------------------------
#  - name: oireachtas_parties
#    type: pipelines.oireachtas_parties_pipeline.OireachtasPartiesPipeline
#    params:
#      chamber: "dail"           # default chamber
#      house_no: 34               # default house number
#      limit: 50                  # per-request limit (configurable, default 50)
#      request_delay: 1.0         # seconds to wait between API calls
#      chunk_size: 500            # DB insert chunk size

#-------------------------------------------------------------------
# Extracts oireachtas parties from the DB table dbo.oireachtas_parties
#-------------------------------------------------------------------
#  - name: oireachtas_parties_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasParty
#        filters:
#          # Example: limit to house_no 34 and parties observed in 2025
#          HouseNo:
#            from: 34
#            to: 34
#        order_by:
#          column: PartyShowAs
#          direction: asc

#-------------------------------------------------------------------
# Extracts oireachtas members via API (normalized into relational tables)
# Extracted for two recent Dail houses (33 and 34)
#-------------------------------------------------------------------
#  - name: oireachtas_members
#    type: pipelines.oireachtas_members_pipeline.OireachtasMembersPipeline
#    params:
#      date_start: "2020-01-01"
#      date_end: "2025-12-31"
#      chamber: "dail"
#      house_no: 33
#      limit: 50
#      request_delay: 1.0
#      chunk_size: 200
#
#  - name: oireachtas_members
#    type: pipelines.oireachtas_members_pipeline.OireachtasMembersPipeline
#    params:
#      date_start: "2020-01-01"
#      date_end: "2025-12-31"
#      chamber: "dail"
#      house_no: 34
#      limit: 50
#      request_delay: 1.0
#      chunk_size: 200


#-------------------------------------------------------------------
# Extracts oireachtas questions and answers from DB tables
#-------------------------------------------------------------------

#  - name: oireachtas_questions_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasQuestion
#        filters:
#          #discussionID: 2058391856
#          QuestionDate:
#            from: "2025-01-01"
#            to: "2025-12-31"
#        order_by:
#          column: QuestionDate
#          direction: desc
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "oireachtas_questions"
#
##-------------------------------------------------------------------
## Extracts oireachtas members from DB tables
##-------------------------------------------------------------------
#
#  - name: oireachtas_members_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasMember
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "oireachtas_members"
#
##-------------------------------------------------------------------
## Extracts oireachtas members membership from DB tables
##-------------------------------------------------------------------
#
#  - name: oireachtas_member_membership_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasMemberMembership
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "oireachtas_member_membership"
#
##-------------------------------------------------------------------
## Extracts oireachtas party  membership from DB tables
##-------------------------------------------------------------------
#
#  - name: oireachtas_member_party_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasMemberPartyMembership
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "oireachtas_member_party_membership"
#
##-------------------------------------------------------------------
## Extracts oireachtas  membership representation  (constituency)
## from DB tables
##-------------------------------------------------------------------
#
#  - name: oireachtas_membership_representation_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasMemberRepresentation
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "oireachtas_member_representation"
#
##-------------------------------------------------------------------
## Extracts oireachtas  party  from DB tables
##-------------------------------------------------------------------
#
#  - name: oireachtas_party_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: OireachtasParty
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "oireachtas_party"

#-------------------------------------------------------------------
# Visualisation of document length for oireachtas questions and answers
#-------------------------------------------------------------------

  - name: oireachtas_question_document_eda
    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
    extractor_type: table
    params:
      extractor_params:
        model: OireachtasQuestion
        filters:
          QuestionDate:
            from: "2025-01-01"
            to: "2025-12-31"

  - name: eda
    type: pipelines.eda_pipeline.EDAPipeline
    params:
      save_path: "output/eda"
      steps:
        - name: document_length
          params:
            columns: ["QuestionText", "AnswerText"]
            unit: "characters"
            output_column: "character_length"
            viz_params:
              - name: histogram
                bins: 30
                xlabel: "Character length"
                ylabel: "Number of documents"
                xscale: "log"
                density: true
                filename: "oireachtas_character_length_histogram.png"
              - name: boxplot
                filename: "oireachtas_character_length_boxplot.png"
        - name: document_length
          params:
            columns: ["QuestionText", "AnswerText"]
            unit: "words"
            output_column: "word_length"
            viz_params:
              - name: histogram
                bins: 30
                xlabel: "Character length"
                ylabel: "Number of documents"
                xscale: "log"
                density: true
                filename: "oireachtas_words_length_histogram.png"
              - name: boxplot
                filename: "oireachtas_words_length_boxplot.png"
        - name: document_length
          params:
            columns: ["QuestionText", "AnswerText"]
            unit: "sentences"
            output_column: "sentence_length"
            viz_params:
              - name: histogram
                bins: 30
                xlabel: "Character length"
                ylabel: "Number of documents"
                xscale: "log"
                density: true
                filename: "oireachtas_sentence_length_histogram.png"
              - name: boxplot
                filename: "oireachtas_sentence_length_boxplot.png"


#-------------------------------------------------------------------
# Extracts boards discussions  from DB tables
#-------------------------------------------------------------------
#
#  - name: boards_discussions_extract
#    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
#    extractor_type: table
#    params:
#      extractor_params:
#        model: BoardsDiscussion
#
#  - name: eda
#    type: pipelines.eda_pipeline.EDAPipeline
#    params:
#      save_path: "output/eda"
#      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "boards_discussions"



#-------------------------------------------------------------------
# Extracts boards comments  from DB tables
# Visualises document length in characters, words, sentences for the 'name' and 'body' fields
#-------------------------------------------------------------------

  - name: boards_discussions_extract
    type: pipelines.data_extractor_pipeline.DataExtractorPipeline
    extractor_type: table
    params:
      extractor_params:
        model: BoardsComment

  - name: boards_comments_eda
    type: pipelines.eda_pipeline.EDAPipeline
    params:
      save_path: "output/eda"
      steps:
#        - name: describe_info
#          params:
#            filename_prefix: "boards_comments"
        - name: document_length
          params:
            columns: ["name", "body"]
            unit: "characters"
            output_column: "character_length"
            viz_params:
              - name: histogram
                bins: 30
                xlabel: "Character length"
                ylabel: "Number of documents"
                xscale: "log"
                density: true
                filename: "boards_comments_character_length_histogram.png"
              - name: boxplot
                filename: "boards_comments_character_length_boxplot.png"
        - name: document_length
          params:
            columns: ["name", "body"]
            unit: "words"
            output_column: "word_length"
            viz_params:
              - name: histogram
                bins: 30
                xlabel: "Character length"
                ylabel: "Number of documents"
                xscale: "log"
                density: true
                filename: "boards_comments_words_length_histogram.png"
              - name: boxplot
                filename: "boards_comments_words_length_boxplot.png"
        - name: document_length
          params:
            columns: ["name", "body"]
            unit: "sentences"
            output_column: "sentence_length"
            viz_params:
              - name: histogram
                bins: 30
                xlabel: "Character length"
                ylabel: "Number of documents"
                xscale: "log"
                density: true
                filename: "boards_comments_sentence_length_histogram.png"
              - name: boxplot
                filename: "boards_comments_sentence_length_boxplot.png"